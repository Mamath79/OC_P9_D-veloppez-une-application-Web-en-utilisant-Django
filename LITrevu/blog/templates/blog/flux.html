{% extends 'base.html' %}

{% block content %}
    <div class="home">
        <h1>Page d'accueil</h1>
        <div class="home_review_button">
            <a href="{% url 'create_ticket' %}" class="btn btn-request-review">Demander une critique</a>
            <a href="{% url 'create_ticket_and_review' %}" class="btn btn-create-review">Créer une critique</a>
        </div>
        
        {% for item in combined_list %}
            {% if item.item_type == 'ticket' %}
            <div class="ticket">
                <div class="author_and_date">
                    <p>Créé par : {{ item.user.username }}</p>
                    <p>Date : {{ item.time_created|date:"d/m/Y H:i" }}</p>
                </div>
                <h3>{{ item.title }}</h3>
                <div class="img_and_description">
                    {% if item.image %}
                    <img src="{{ item.image.url }}" alt="Image du ticket">
                    {% endif %}
                    <p>Description : {{ item.description }}</p>
                </div>

                {% if item.user == user %}
                    <div class="ticket-actions">               
                            <a href="{% url 'update_ticket' item.id %}" class="btn">Modifier</a>
                            <a href="{% url 'delete_ticket' item.id %}" class="btn danger">Supprimer</a>
                    </div>
                {% endif %}
                {% if item.user.id in followed_users %}
                    <div class="ticket-actions">               
                            <a href="{% url 'create_review' item.id %}" class="btn">Emettre une critique</a>
                    </div>
                {% endif %}
            </div>
            
            {% elif item.item_type == 'review' %}
            <div class="review">
                <!-- Informations de la review -->
                <h2>{{ item.headline }}</h2>
                <p>Date de création : {{ item.time_created|date:"H:i d/m/Y" }}</p>
                <p>{{ item.body }}</p>
                <p>Note: {{ item.rating }}/5</p>

                <!-- Informations du ticket associé -->
                <div class="associated-ticket">
                    <div class="author_and_date">
                        <p>Créé par : {{ item.ticket.user.username }}</p>
                        <p>Date : {{ item.ticket.time_created|date:"d/m/Y H:i" }}</p>
                    </div>
                    <h3>Ticket associé : {{ item.ticket.title }}</h3>
                    <div class="img_and_description">
                        {% if item.ticket.image %}
                        <img src="{{ item.ticket.image.url }}" alt="Image du ticket">
                        {% endif %}
                    <p>Description : {{ item.ticket.description }}</p>
                    </div>
                </div>
                
                <!-- Boutons Modifier et Supprimer uniquement si item a un id -->
                {% if item.user == user %}
                    <div class="review-actions">
                        <a href="{% url 'update_review' item.id %}" class="btn">Modifier</a>
                        <a href="{% url 'delete_review' item.id %}" class="btn danger">Supprimer</a>
                    </div>
                {% endif %}
            </div>
            {% endif %}
        {% endfor %}
    </div>
{% endblock %}
